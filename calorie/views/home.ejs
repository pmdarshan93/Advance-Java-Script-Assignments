<%-include("partials/header")%>
<div class="container">
  <div class="hero">
    <h1>Welcome to the Home Page</h1>
    <p>This is my EJS + Express setup!</p>
  </div>

  <section id="calorie-calculator" class="card" style="max-width:720px;">
    <h2>Calorie Burn Calculator</h2>
    <form id="calc-form">
      <div>
        <label for="weight">Weight (kg)</label>
        <input id="weight" name="weight" type="number" step="0.1" min="1" required />
      </div>
      <div>
        <label for="minutes">Duration (minutes)</label>
        <input id="minutes" name="minutes" type="number" step="1" min="1" required />
      </div>
      <div class="full">
        <label for="activity">Activity</label>
        <select id="activity" name="activity">
          <option value="walking">Walking</option>
          <option value="brisk_walking">Brisk Walking</option>
          <option value="running">Running</option>
          <option value="cycling">Cycling</option>
          <option value="swimming">Swimming</option>
          <option value="yoga">Yoga</option>
          <option value="gardening">Gardening</option>
          <option value="hiking">Hiking</option>
          <option value="sitting">Sitting</option>
        </select>
      </div>

      <div class="full controls">
        <button id="calc-btn" class="btn btn-primary" type="submit">Calculate</button>
        <button id="reset-btn" class="btn btn-muted" type="button">Reset</button>
      </div>
    </form>

    <div id="result"></div>
  </section>
</div>

<footer>
  <p>Â© 2025 My Express App</p>
</footer>

<script>
  // Submit the form to server endpoint `/api/calories` and show result.
  document.getElementById('calc-form').addEventListener('submit', async function (e) {
    e.preventDefault();
    const weight = parseFloat(document.getElementById('weight').value);
    const minutes = parseFloat(document.getElementById('minutes').value);
    const activity = document.getElementById('activity').value;

    document.getElementById('result').textContent = 'Calculating...';

    try {
      if (!(weight > 0) || !(minutes > 0)) throw new Error('Enter positive numbers');

      const res = await fetch('/api/calories', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ weight, minutes, activity })
      });
      const json = await res.json();
      if (!res.ok) {
        document.getElementById('result').textContent = json.error || 'Server error';
        return;
      }
      document.getElementById('result').textContent = `${json.calories} kcal burned (source: ${json.source})`;
    } catch (err) {
      document.getElementById('result').textContent = err.message || 'Request failed';
    }
  });

  document.getElementById('reset-btn').addEventListener('click', function () {
    document.getElementById('calc-form').reset();
    document.getElementById('result').textContent = '';
  });
</script>
</body>
</html>